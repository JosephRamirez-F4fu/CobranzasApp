<section class="mx-auto grid max-w-6xl gap-6">
  <app-institution-enrollment-schedule-form
    [form]="form"
    [saving]="saving()"
    [editing]="editing()"
    (submitted)="onSubmit()"
    (canceled)="onCancelEdit()"
    (cleared)="onClearForm()"
  ></app-institution-enrollment-schedule-form>

  <div
    *ngIf="feedback() as message"
    class="rounded-xl bg-emerald-50 px-4 py-3 text-sm font-semibold text-emerald-700 shadow-lg shadow-emerald-500/20"
  >
    {{ message }}
  </div>

  <form
    [formGroup]="filtersForm"
    (ngSubmit)="onApplyFilters()"
    class="grid gap-4 rounded-2xl bg-white p-4 shadow-lg shadow-slate-900/5 sm:grid-cols-[repeat(auto-fit,minmax(220px,1fr))]"
  >
    <div class="flex flex-col gap-1">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-900" for="filter-year">
        A?o lectivo
      </label>
      <input
        id="filter-year"
        type="number"
        formControlName="anioLectivo"
        placeholder="Ej. 2024"
        min="2000"
        class="rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm font-medium text-slate-900 placeholder:text-slate-900 shadow-sm transition focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-200"
      />
    </div>
    <div class="flex flex-col gap-1">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-900" for="filter-level">
        Nivel educativo
      </label>
      <select
        id="filter-level"
        formControlName="nivelEducativo"
        class="rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm font-medium text-slate-900 placeholder:text-slate-900 shadow-sm transition focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-200"
      >
        <option value="">Todos</option>
        <option *ngFor="let level of levels" [value]="level">{{ level | titlecase }}</option>
      </select>
    </div>
    <div class="flex flex-col gap-1">
      <label class="text-xs font-semibold uppercase tracking-wide text-slate-900" for="filter-status">
        Estado
      </label>
      <select
        id="filter-status"
        formControlName="activo"
        class="rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm font-medium text-slate-900 placeholder:text-slate-900 shadow-sm transition focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-200"
      >
        <option value="">Todos</option>
        <option value="true">Activos</option>
        <option value="false">Inactivos</option>
      </select>
    </div>
    <div class="flex items-end gap-3">
      <button
        type="submit"
        class="inline-flex items-center justify-center rounded-full bg-indigo-500 px-5 py-2.5 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:-translate-y-0.5 hover:shadow-indigo-500/40"
      >
        Aplicar filtros
      </button>
      <button
        type="button"
        (click)="onResetFilters()"
        class="inline-flex items-center justify-center rounded-full bg-slate-200 px-5 py-2.5 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:bg-slate-300"
      >
        Limpiar filtros
      </button>
    </div>
  </form>

  <app-institution-enrollment-schedule-table
    [schedules]="schedules()"
    [loading]="loading()"
    [page]="page()"
    [totalPages]="totalPages()"
    [totalItems]="totalItems()"
    (edit)="onEdit($event)"
    (remove)="onDelete($event)"
    (editQuota)="onEditQuota($event)"
    (pageChange)="onPageChange($event)"
  ></app-institution-enrollment-schedule-table>

  <form
    *ngIf="selectedQuotaSchedule() as schedule"
    [formGroup]="quotaForm"
    (ngSubmit)="onSubmitQuota()"
    class="grid gap-4 rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/10"
  >
    <header class="space-y-1">
      <h3 class="text-lg font-semibold text-slate-900">
        Editar cuota del cronograma {{ schedule.anioLectivo }} - {{ schedule.nivelEducativo | titlecase }}
      </h3>
      <p class="text-sm text-slate-900">
        Actualiza el monto y la fecha de vencimiento de la cuota seleccionada.
      </p>
    </header>

    <div class="grid gap-4 sm:grid-cols-2">
      <label class="flex flex-col gap-1 font-semibold text-slate-900">
        <span class="text-sm">Monto (S/)</span>
        <input
          type="number"
          formControlName="monto"
          placeholder="Ej. 350"
          min="0"
          step="0.01"
          class="rounded-xl border border-slate-300 bg-white px-4 py-3 text-sm font-medium text-slate-900 placeholder:text-slate-900 shadow-sm transition focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-200"
          [ngClass]="{
            'border-rose-400 focus:border-rose-500 focus:ring-rose-200':
              quotaForm.controls['monto'].invalid && quotaForm.controls['monto'].touched
          }"
        />
        <small
          *ngIf="quotaForm.controls['monto'].invalid && quotaForm.controls['monto'].touched"
          class="text-sm font-medium text-rose-500"
        >
          Ingrese un monto v?lido.
        </small>
      </label>

      <label class="flex flex-col gap-1 font-semibold text-slate-900">
        <span class="text-sm">Fecha de vencimiento</span>
        <input
          type="date"
          formControlName="fechaVencimiento"
          class="rounded-xl border border-slate-300 bg-white px-4 py-3 text-sm font-medium text-slate-900 placeholder:text-slate-900 shadow-sm transition focus:border-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-200"
          [ngClass]="{
            'border-rose-400 focus:border-rose-500 focus:ring-rose-200':
              quotaForm.controls['fechaVencimiento'].invalid && quotaForm.controls['fechaVencimiento'].touched
          }"
        />
        <small
          *ngIf="quotaForm.controls['fechaVencimiento'].invalid && quotaForm.controls['fechaVencimiento'].touched"
          class="text-sm font-medium text-rose-500"
        >
          Seleccione una fecha de vencimiento.
        </small>
      </label>
    </div>

    <footer class="flex flex-wrap items-center gap-3">
      <button
        type="submit"
        [disabled]="quotaForm.invalid || quotaSaving()"
        class="inline-flex items-center justify-center rounded-full bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-2.5 text-sm font-semibold text-white shadow-lg shadow-amber-500/30 transition hover:-translate-y-0.5 hover:shadow-amber-500/40 disabled:cursor-not-allowed disabled:opacity-70"
      >
        {{ quotaSaving() ? 'Actualizando?' : 'Actualizar cuota' }}
      </button>
      <button
        type="button"
        (click)="onCancelQuotaEdit()"
        [disabled]="quotaSaving()"
        class="inline-flex items-center justify-center rounded-full bg-slate-200 px-6 py-2.5 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:bg-slate-300 disabled:cursor-not-allowed disabled:opacity-70"
      >
        Cancelar
      </button>
    </footer>
  </form>
</section>
