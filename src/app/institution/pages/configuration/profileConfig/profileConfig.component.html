<section class="workspace-stack">
  <app-config-section title="Perfil de Usuario" maxWidthClass="w-full">
    @if (loading()) {
      <p class="workspace-subheading">Cargando...</p>
    } @else {
      <form class="workspace-form" [formGroup]="form" (ngSubmit)="save()">
        <div class="workspace-fieldset">
          <label class="workspace-field">
            <span class="workspace-label">Nombre completo</span>
            <input
              type="text"
              formControlName="nombreCompleto"
              class="workspace-input workspace-input--compact"
              [ngClass]="{
                'workspace-input-error':
                  form.controls.nombreCompleto.invalid && form.controls.nombreCompleto.touched
              }"
            />
            @if(form.controls.nombreCompleto.invalid && form.controls.nombreCompleto.touched){
              <p class="workspace-error">Requerido.</p>
            }
          </label>

          <label class="workspace-field">
            <span class="workspace-label">Correo</span>
            <input
              type="email"
              formControlName="correo"
              class="workspace-input workspace-input--compact"
              [ngClass]="{
                'workspace-input-error': form.controls.correo.invalid && form.controls.correo.touched
              }"
            />
            @if(form.controls.correo.invalid && form.controls.correo.touched){
              <p class="workspace-error">Correo inválido.</p>
            }
          </label>
        </div>

        <app-config-form-actions
          [editing]="editing()"
          [saving]="saving()"
          (edit)="enableEdit()"
          (cancel)="cancel()"
        />
      </form>
    }
  </app-config-section>

  <app-config-section title="Cambiar Contraseña" maxWidthClass="w-full">
    <form class="workspace-form" [formGroup]="formChangPassword" (ngSubmit)="changePassword()">
      <label class="workspace-field">
        <span class="workspace-label">Contraseña actual</span>
        <input
          type="password"
          formControlName="oldPassword"
          class="workspace-input workspace-input--compact"
          autocomplete="current-password"
          [ngClass]="{
            'workspace-input-error':
              formChangPassword.controls.oldPassword.invalid && formChangPassword.controls.oldPassword.touched
          }"
        />
        @if(formChangPassword.controls.oldPassword.invalid && formChangPassword.controls.oldPassword.touched){
          <p class="workspace-error">Requerido.</p>
        }
      </label>

      <div class="workspace-fieldset">
        <label class="workspace-field">
          <span class="workspace-label">Nueva contraseña</span>
          <input
            type="password"
            formControlName="newPassword"
            class="workspace-input workspace-input--compact"
            autocomplete="new-password"
            [ngClass]="{
              'workspace-input-error':
                formChangPassword.controls.newPassword.invalid && formChangPassword.controls.newPassword.touched
            }"
          />
          @if(formChangPassword.controls.newPassword.invalid && formChangPassword.controls.newPassword.touched){
            <p class="workspace-error">La contraseña debe tener al menos 6 caracteres.</p>
          }
        </label>

        <label class="workspace-field">
          <span class="workspace-label">Confirmar nueva contraseña</span>
          <input
            type="password"
            formControlName="confirmNewPassword"
            class="workspace-input workspace-input--compact"
            autocomplete="new-password"
            [ngClass]="{
              'workspace-input-error':
                formChangPassword.controls.confirmNewPassword.invalid &&
                formChangPassword.controls.confirmNewPassword.touched
            }"
          />
          @if(formChangPassword.controls.confirmNewPassword.invalid && formChangPassword.controls.confirmNewPassword.touched){
            <p class="workspace-error">Las contraseñas no coinciden.</p>
          }
        </label>
      </div>

      <div class="workspace-form-actions">
        <button
          type="submit"
          class="workspace-primary-btn workspace-btn-compact"
          [disabled]="changingPassword()"
        >
          @if(changingPassword()){ Cambiando... } @else { Cambiar contraseña }
        </button>
      </div>
    </form>
  </app-config-section>
</section>
