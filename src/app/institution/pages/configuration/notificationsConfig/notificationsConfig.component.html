<section class="workspace-stack">
  <app-config-section title="Notificaciones" maxWidthClass="w-full">
    @if (loading()) {
      <p class="workspace-subheading">Cargando configuración...</p>
    }

    <div class="workspace-form-actions">
      @for (m of medios; track m) {
        <button
          type="button"
          (click)="selectMedio(m)"
          class="workspace-pill"
          [ngClass]="
            medioSeleccionado() === m
              ? 'workspace-pill--accent'
              : 'workspace-pill--ghost'
          "
        >
          {{ m }}
        </button>
      }
    </div>

    <form [formGroup]="form" (ngSubmit)="save()" class="workspace-form">
      <div class="workspace-fieldset">
        <label class="workspace-field">
          <span class="workspace-label">Medio</span>
          <input
            type="text"
            formControlName="medioEnvio"
            class="workspace-input workspace-input--compact"
            readonly
          />
        </label>

        <div class="workspace-checkbox-row">
          <input id="activo" type="checkbox" formControlName="activo" />
          <label for="activo">Habilitado</label>
        </div>

        <label class="workspace-field">
          <span class="workspace-label">Frecuencia</span>
          <input
            type="text"
            formControlName="frecuencia"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.frecuencia.invalid && form.controls.frecuencia.touched
            }"
          />
          @if(form.controls.frecuencia.invalid && form.controls.frecuencia.touched){
            <p class="workspace-error">Requerido.</p>
          }
        </label>

        <label class="workspace-field">
          <span class="workspace-label">Día del mes</span>
          <input
            type="number"
            formControlName="diadDelMes"
            class="workspace-input workspace-input--compact"
            min="1"
            max="31"
          />
        </label>

        <label class="workspace-field">
          <span class="workspace-label">Hora de envío</span>
          <input
            type="time"
            formControlName="horaEnvio"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.horaEnvio.invalid && form.controls.horaEnvio.touched
            }"
          />
          @if(form.controls.horaEnvio.invalid && form.controls.horaEnvio.touched){
            <p class="workspace-error">Requerido.</p>
          }
        </label>

        <label class="workspace-field workspace-field--full">
          <span class="workspace-label">Mensaje</span>
          <textarea
            rows="4"
            formControlName="mensaje"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.mensaje.invalid && form.controls.mensaje.touched
            }"
          ></textarea>
          @if(form.controls.mensaje.invalid && form.controls.mensaje.touched){
            <p class="workspace-error">Mínimo 3 caracteres.</p>
          }
        </label>

        @if(medioSeleccionado() === emailMedio){
          <label class="workspace-field workspace-field--full">
            <span class="workspace-label">Asunto (Email)</span>
            <input
              type="text"
              formControlName="asunto"
              class="workspace-input workspace-input--compact"
              [ngClass]="{
                'workspace-input-error': form.controls.asunto.invalid && form.controls.asunto.touched
              }"
            />
            @if(form.controls.asunto.invalid && form.controls.asunto.touched){
              <p class="workspace-error">Requerido.</p>
            }
          </label>
        }
      </div>

      <app-config-form-actions
        [editing]="editing()"
        [saving]="saving()"
        [disableSave]="form.invalid"
        (edit)="enableEdit()"
        (cancel)="cancel()"
      />
    </form>
  </app-config-section>
</section>
