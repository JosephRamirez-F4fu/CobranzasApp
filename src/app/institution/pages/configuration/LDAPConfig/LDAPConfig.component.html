<section class="workspace-stack">
  <app-config-section title="Configuración LDAP" maxWidthClass="w-full">
    @if (loading()) {
      <p class="workspace-subheading">Cargando configuración...</p>
    }

    <form [formGroup]="form" (ngSubmit)="save()" class="workspace-form">
      <div class="workspace-checkbox-row">
        <input id="useLdap" type="checkbox" formControlName="useLdap" />
        <label for="useLdap">Habilitar autenticación LDAP</label>
      </div>

      <div class="workspace-fieldset">
        <label class="workspace-field">
          <span class="workspace-label">Host</span>
          <input
            formControlName="ldapHost"
            type="text"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.ldapHost.invalid && form.controls.ldapHost.touched
            }"
          />
          @if(form.controls.ldapHost.invalid && form.controls.ldapHost.touched){
            <p class="workspace-error">Requerido.</p>
          }
        </label>

        <label class="workspace-field">
          <span class="workspace-label">Puerto</span>
          <input
            formControlName="ldapPort"
            type="text"
            inputmode="numeric"
            pattern="\d*"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.ldapPort.invalid && form.controls.ldapPort.touched
            }"
          />
          @if(form.controls.ldapPort.invalid && form.controls.ldapPort.touched){
            <p class="workspace-error">Número válido requerido.</p>
          }
        </label>

        <label class="workspace-field workspace-field--full">
          <span class="workspace-label">Base DN</span>
          <input
            formControlName="ldapBaseDn"
            type="text"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.ldapBaseDn.invalid && form.controls.ldapBaseDn.touched
            }"
          />
          @if(form.controls.ldapBaseDn.invalid && form.controls.ldapBaseDn.touched){
            <p class="workspace-error">Requerido.</p>
          }
        </label>

        <label class="workspace-field">
          <span class="workspace-label">User DN</span>
          <input
            formControlName="ldapUserDn"
            type="text"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.ldapUserDn.invalid && form.controls.ldapUserDn.touched
            }"
          />
          @if(form.controls.ldapUserDn.invalid && form.controls.ldapUserDn.touched){
            <p class="workspace-error">Requerido.</p>
          }
        </label>

        <label class="workspace-field">
          <span class="workspace-label">Password</span>
          <input
            formControlName="ldapPassword"
            type="password"
            autocomplete="new-password"
            class="workspace-input workspace-input--compact"
            [ngClass]="{
              'workspace-input-error': form.controls.ldapPassword.invalid && form.controls.ldapPassword.touched
            }"
          />
          @if(form.controls.ldapPassword.invalid && form.controls.ldapPassword.touched){
            <p class="workspace-error">Requerido cuando LDAP está habilitado.</p>
          }
        </label>
      </div>

      <app-config-form-actions
        [editing]="editing()"
        [saving]="saving()"
        [disableSave]="form.invalid"
        (edit)="enableEdit()"
        (cancel)="cancel()"
      />
    </form>
  </app-config-section>
</section>
